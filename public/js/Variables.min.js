(function($, document, HYYAN_WPI_VARIABLES) {
    class Variables {
        constructor($, document, data) {
            this.$ = $;
            this.document = document;
            this.data = data;
            this._dialog = this._createDialog();
        }

        init() {
            this.$('#post_lang_choice').on('change', () => this.shouldAlert());
            this.$('#product-type').on('change', () => this.shouldAlert());
        }

        shouldAlert() {
            const currentProduct = this.getCurrentProduct();
            const currentLang = this.getCurrentLanguage();

            if (currentProduct === 'variable' && currentLang !== this.data.defaultLang) {
                this._dialog.dialog('open');
                this._changeSaveBoxState(true);
                return true;
            }

            this._changeSaveBoxState(false);
            return false;
        }

        getCurrentLanguage() {
            return this.$('#post_lang_choice').val();
        }

        getCurrentProduct() {
            return this.$('#product-type').val();
        }

        _changeSaveBoxState(disabled) {
            this.$('#submitdiv *').prop('disabled', disabled);
        }

        _createDialog() {
            const dialog = this.$('<div/>')
                .html(this.data.content)
                .attr('title', this.data.title)
                .appendTo('body');

            dialog.dialog({
                dialogClass: 'wp-dialog',
                autoOpen: false,
                modal: true,
                width: 400,
                height: 250,
                position: {
                    my: 'center',
                    at: 'center'
                },
                buttons: [{
                    text: 'Got It',
                    click: function() {
                        $(this).dialog('close');
                    }
                }]
            });

            return dialog;
        }
    }

    $(function() {
        new Variables($, document, HYYAN_WPI_VARIABLES).init();
    });
})(jQuery, document, HYYAN_WPI_VARIABLES);
